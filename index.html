<!DOCTYPE html>
<html>
<head>
    <title>Secret Whiteboard - Debug</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 50px auto; padding: 20px; background: #f5f5f5; }
        .debug { background: #fff; padding: 20px; border-radius: 10px; margin: 20px 0; }
        .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .success { background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin: 10px 0; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üîß Debug: Secret Whiteboard</h1>
    
    <div class="debug">
        <h3>1. Test GitHub API Connection</h3>
        <button onclick="testConnection()">Test Connection</button>
        <div id="connection-result"></div>
    </div>

    <div class="debug">
        <h3>2. Check if index.html exists</h3>
        <button onclick="checkFile()">Check File</button>
        <div id="file-result"></div>
    </div>

    <div class="debug">
        <h3>3. Login & Test</h3>
        <input id="user" placeholder="Username" value="g26"><br>
        <input id="pass" type="password" placeholder="Password" value="1234"><br>
        <button onclick="testLogin()">Test Login</button>
        <div id="login-result"></div>
    </div>

    <script>
        // Your GitHub credentials with obfuscated token
        const GITHUB_USERNAME = 'Vahab4';
        const GITHUB_REPO = 'med26hub';
        
        // Obfuscated token reconstruction (same as before)
        const tokenPart1 = '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';
        const tokenPart2 = 314159;
        const tokenPart3 = 42;
        
        function reconstructToken() {
            const mathConstant = Math.PI * Math.E * Math.SQRT2;
            const rotation = (tokenPart2 * tokenPart3) % 256;
            const shift = Math.floor(mathConstant * 100) % 64;
            
            let reconstructed = tokenPart1;
            const shifted = reconstructed.split('').map(char => {
                const code = char.charCodeAt(0);
                if (code >= 65 && code <= 90) {
                    return String.fromCharCode((code - 65 + shift) % 26 + 65);
                } else if (code >= 97 && code <= 122) {
                    return String.fromCharCode((code - 97 + shift) % 26 + 97);
                } else if (code >= 48 && code <= 57) {
                    return String.fromCharCode((code - 48 + rotation) % 10 + 48);
                }
                return char;
            }).join('');
            
            const finalToken = shifted.split('').map((char, i) => {
                const code = char.charCodeAt(0);
                const xorValue = (rotation + i * tokenPart3) % 256;
                return String.fromCharCode(code ^ xorValue);
            }).join('');
            
            return finalToken.split('').reverse().join('').replace(/[^a-zA-Z0-9_]/g, '');
        }
        
        const GITHUB_TOKEN = reconstructToken();
        
        async function testConnection() {
            const resultDiv = document.getElementById('connection-result');
            resultDiv.innerHTML = '<div class="error">Testing...</div>';
            
            try {
                const response = await fetch(`https://api.github.com/user`, {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const user = await response.json();
                    resultDiv.innerHTML = `
                        <div class="success">‚úÖ Connection OK!</div>
                        <strong>User:</strong> ${user.login}<br>
                        <strong>Token works!</strong>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">‚ùå Connection failed: ${response.status} ${response.statusText}</div>
                        <pre>${await response.text()}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">‚ùå Network error: ${error.message}</div>
                `;
            }
        }

        async function checkFile() {
            const resultDiv = document.getElementById('file-result');
            resultDiv.innerHTML = '<div class="error">Checking...</div>';
            
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/index.html`, {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const fileData = await response.json();
                    resultDiv.innerHTML = `
                        <div class="success">‚úÖ File found!</div>
                        <strong>Name:</strong> ${fileData.name}<br>
                        <strong>Size:</strong> ${fileData.size} bytes<br>
                        <strong>HTML:</strong> ${fileData.download_url}
                    `;
                } else {
                    if (response.status === 404) {
                        resultDiv.innerHTML = `
                            <div class="error">‚ùå File NOT found!</div>
                            <strong>Solution:</strong> Upload index.html to your repository first!
                        `;
                    } else {
                        resultDiv.innerHTML = `
                            <div class="error">‚ùå Error: ${response.status} ${response.statusText}</div>
                            <pre>${await response.text()}</pre>
                        `;
                    }
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">‚ùå Network error: ${error.message}</div>
                `;
            }
        }

        function testLogin() {
            const user = document.getElementById('user').value;
            const pass = document.getElementById('pass').value;
            
            const resultDiv = document.getElementById('login-result');
            
            if (user === 'g26' && pass === '1234') {
                resultDiv.innerHTML = '<div class="success">‚úÖ Login successful! You can use the main app now.</div>';
                loadMessagesFromGitHub();
            } else {
                resultDiv.innerHTML = '<div class="error">‚ùå Wrong username or password!</div>';
            }
        }

        async function loadMessagesFromGitHub() {
            const resultDiv = document.getElementById('login-result');
            resultDiv.innerHTML += '<div>üîÑ Loading messages...</div>';
            
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/index.html`, {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!response.ok) {
                    resultDiv.innerHTML += `
                        <div class="error">‚ùå Failed to load messages: ${response.status}</div>
                        <strong>Check:</strong>
                        1. Did you upload index.html to your repo?<br>
                        2. Is the file named exactly "index.html"?<br>
                        3. Click "Check File" button above to test
                    `;
                    return;
                }
                
                const fileData = await response.json();
                const content = atob(fileData.content);
                
                resultDiv.innerHTML += `
                    <div class="success">‚úÖ File loaded successfully!</div>
                    <strong>File size:</strong> ${content.length} characters<br>
                    <strong>Messages found:</strong> ${content.includes('MESSAGES START') ? 'Yes' : 'No'}
                `;
                
            } catch (error) {
                resultDiv.innerHTML += `
                    <div class="error">‚ùå Error: ${error.message}</div>
                `;
            }
        }

        // Test connection on page load
        window.onload = function() {
            testConnection();
            setTimeout(checkFile, 1000);
        };
    </script>
</body>
</html>
