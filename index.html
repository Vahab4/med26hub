<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Secret Anonymous Board</title>
<style>
  body { font-family: Arial, sans-serif; background: #121212; color: #eee; padding: 20px; }
  #board { background: #1e1e1e; padding: 20px; height: 300px; overflow-y: scroll; margin-bottom: 10px; border-radius: 12px; }
  .message { background: #292929; padding: 10px; margin-bottom: 8px; border-radius: 8px; }
  .timestamp { font-size: 0.8em; color: #888; margin-bottom: 5px; }
  #message { width: 70%; padding: 10px; border-radius: 8px; border: none; background: #1e1e1e; color: #eee; }
  #sendBtn { padding: 10px 20px; border-radius: 8px; border: none; background: #6200ee; color: white; cursor: pointer; }
  #sendBtn:hover { background: #3700b3; }
</style>
</head>
<body>

<h1>Secret Anonymous Board</h1>

<div id="board">Loading messages...</div>

<input type="text" id="message" placeholder="Type your secret message..." />
<button id="sendBtn">Send</button>

<script>
const webAppUrl = "https://script.google.com/macros/s/AKfycbx8ghHjMU8N4i1SmGWnl0YS3lgDV2p6xYKDs5gsM6mlvGC3-ze3ONWyBXXlGKIe1J9SYw/exec";

// Load all messages
async function loadMessages() {
  try {
    const res = await fetch(webAppUrl);
    const messages = await res.json();
    const board = document.getElementById("board");
    
    if(messages.length === 0){
      board.innerHTML = "No messages yet.";
      return;
    }

    board.innerHTML = messages.map(msg => 
      `<div class="message">
         <div class="timestamp">${new Date(msg.timestamp).toLocaleString()}</div>
         <div>${msg.text}</div>
       </div>`
    ).join('');
    board.scrollTop = board.scrollHeight;
  } catch (e) {
    document.getElementById("board").innerText = "Unable to load messages.";
    console.error(e);
  }
}

// Send a new message
document.getElementById("sendBtn").addEventListener("click", async () => {
  const input = document.getElementById("message");
  const msg = input.value.trim();
  if (!msg) return;

  try {
    await fetch(webAppUrl, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: `message=${encodeURIComponent(msg)}`
    });
    input.value = "";
    loadMessages();
  } catch (e) {
    alert("Failed to send message");
    console.error(e);
  }
});

// Refresh messages every 5 seconds
setInterval(loadMessages, 5000);
loadMessages();
</script>

</body>
</html>
