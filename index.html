<!DOCTYPE html>
<html>
<head>
  <title>Secret Board</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial; background: #222; color: white; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; }
    #board { background: red; flex: 1; padding: 20px; overflow-y: auto; }
    #board p { margin: 5px 0; word-wrap: break-word; }
    #inputContainer { display: flex; padding: 10px; background: #333; }
    #messageInput { flex: 1; padding: 10px; font-size: 16px; border: none; border-radius: 5px; }
    #sendBtn { padding: 10px 20px; margin-left: 5px; font-size: 16px; border: none; border-radius: 5px; background: #4CAF50; color: white; cursor: pointer; }
    #sendBtn:hover { background: #45a049; }
    #loginDiv { margin: auto; text-align: center; }
    #pw { padding: 10px; font-size: 16px; width: 60%; }
  </style>
</head>
<body>

<div id="loginDiv">
  <h1>Secret Board</h1>
  <p>Enter password to access:</p>
  <input type="password" id="pw" placeholder="Password">
  <button onclick="checkPassword()">Enter</button>
</div>

<div id="boardContainer" style="display:none; flex: 1; flex-direction: column; height: 100vh;">
  <div id="board">Loading messages...</div>
  <div id="inputContainer">
    <input type="text" id="messageInput" placeholder="Type your secret message" onkeypress="if(event.key==='Enter'){sendMessage();}">
    <button id="sendBtn" onclick="sendMessage()">Send</button>
  </div>
  <iframe name="hidden_iframe" style="display:none;"></iframe>
</div>

<script>
const PASSWORD = "1234";
const FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdVrAcsVi-TwSdYJqfc2xmBp1WP0cQ4sZuiFrMLqOj70ZOKSA/formResponse";
const ENTRY_ID = "entry.1564244321";
const SHEET_URL = "https://script.google.com/macros/s/AKfycbxEJs06Vwa8JwIrxxs8llrKuQfWnF6VAzdO5KORx2WlMeqFvMecNGLEkXUK0Fr_gd9XFQ/exec";

function checkPassword() {
  const pw = document.getElementById('pw').value;
  if(pw === PASSWORD) {
    document.getElementById('loginDiv').style.display = 'none';
    document.getElementById('boardContainer').style.display = 'flex';
    loadMessages();
  } else {
    alert("Wrong password!");
  }
}

// Load messages from Apps Script Web App
async function loadMessages() {
  try {
    const res = await fetch(SHEET_URL);
    const messages = await res.json();
    const board = document.getElementById('board');
    board.innerHTML = messages.map(m => `<p>${m}</p>`).join("");
    board.scrollTo({ top: board.scrollHeight, behavior: 'smooth' });
  } catch(err) {
    document.getElementById('board').innerHTML = "Unable to load messages.";
    console.error(err);
  }
  setTimeout(loadMessages, 5000); // refresh every 5 seconds
}

// Send message via hidden Google Form
function sendMessage() {
  const msg = document.getElementById('messageInput').value;
  if(!msg) return alert("Type a message!");

  // Optimistically show the message immediately
  const board = document.getElementById('board');
  const p = document.createElement('p');
  p.textContent = msg;
  p.style.opacity = '0.6'; // slightly faded until confirmed
  board.appendChild(p);
  board.scrollTo({ top: board.scrollHeight, behavior: 'smooth' });

  // Send to Google Form
  const form = document.createElement("form");
  form.action = FORM_URL;
  form.method = "POST";
  form.target = "hidden_iframe";

  const input = document.createElement("input");
  input.type = "hidden";
  input.name = ENTRY_ID;
  input.value = msg;

  form.appendChild(input);
  document.body.appendChild(form);
  form.submit();
  document.body.removeChild(form);

  document.getElementById('messageInput').value = "";
}
</script>

</body>
</html>
